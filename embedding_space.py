""" 
A play ground for embedding space exploration
"""

import pandas as pd
import numpy as np

# Read the .parquet file
# df = pd.read_parquet('example1/.chroma/english_wikipedia/train-00016-of-00022-d282c8bfe7e88162.parquet')
# texts = df['maintext'].tolist()
# print(df.info())

texts = ["this is a sentance about hotdogs"
         , "this is a sentance about cats"
         , "this is a sentance about dogs"
         , "this is a sentance about cats and dogs"
         , "this is a sentance about cats and dogs and hotdogs"
         , "we need more buns"
         , "we have plenty of musturd"
         , "we have ten ounces of ketchup"
         , "the relish is in the fridge"
         ]

embedding_0 = [-0.496636986732483, -0.490822970867157, -0.249457553029060,
0.214168012142181, -0.124779865145683, -0.226992309093475,
0.644484519958496, -0.421964079141617, 0.279815793037415,
-0.512128233909607, 0.015090026892722, -0.338464945554733,
0.040877349674702, -0.567533075809479, 0.301926642656326,
-0.191479727625847, 0.951743185520172, -0.384793877601624,
-0.355870991945267, -0.032021638005972, -0.059779275208712,
0.037061776965857, -0.383139312267303, 0.001171125564724,
0.260334372520447, -0.149235174059868, -0.274403721094131,
0.066542118787766, -0.283694148063660, 0.427139788866043,
0.524304926395416, -0.293084532022476, -0.464552789926529,
0.056118573993444, -0.286241263151169, 0.386784642934799,
0.299854069948196, -0.115257948637009, 0.152426183223724,
0.265757292509079, 0.302077233791351, -0.316411226987839,
-0.088786996901035, -0.301446467638016, -0.202449366450310,
0.389547824859619, -0.781098365783691, 0.281774997711182,
0.164721429347992, -0.070138923823833, -0.546473085880280,
-0.098873309791088, 0.010255442000926, 0.168719708919525,
0.491721242666245, -0.065390422940254, -0.091153457760811,
0.352765470743179, -0.441290944814682, -0.255966842174530,
0.175345927476883, -0.514293909072876, 0.192171707749367,
-0.118939071893692, 0.391596674919128, -0.403518199920654,
-0.368846505880356, 0.509725689888000, 0.235359579324722,
-0.277250409126282, 0.057941611856222, 0.311583787202835,
0.171925082802773, 0.176108539104462, -0.040991179645061,
0.630366504192352, 0.036445494741201, -0.909760057926178,
0.012968226335943, -0.114645212888718, -0.368593662977219,
-0.310440808534622, -0.143812984228134, 0.270033240318298,
-0.157804861664772, 0.152381360530853, 0.156214773654938,
-0.184750884771347, -0.448699116706848, -0.379814893007278,
-0.036043819040060, -0.235360771417618, 0.710780203342438,
-0.059289883822203, 0.327707886695862, 0.351343601942062,
-0.359472543001175, -0.717504262924194, -0.607169151306152,
0.316597193479538, 0.109210252761841, 0.008698934689164,
-0.070000849664211, -0.526839196681976, 0.239130601286888,
-0.647734224796295, -0.426499634981155, 0.352944374084473,
0.059861078858376, 0.111553952097893, -0.231837227940559,
-0.013866859488189, 0.135452598333359, 0.053328644484282,
-0.609141528606415, -0.314096689224243, -0.078944526612759,
0.107065580785275, 0.158629372715950, -0.414777547121048,
0.379516243934631, 0.307955622673035, 0.089956372976303,
-0.375634014606476, -0.353580027818680, -0.102854363620281,
0.457428842782974, 0.297934412956238, -0.456290990114212,
0.043672040104866, -0.051620587706566, 0.030086642131209,
0.589998662471771, 0.122857563197613, -0.424597173929214,
-0.059631038457155, 0.329018741846085, 0.370472341775894,
-0.226640656590462, 0.349942892789841, -0.387059032917023, 
0.255556583404541, -0.010265910997987, -0.912834525108337,
0.284008860588074, 0.200612455606461, 0.294975787401199,
-0.298637330532074, -0.381711572408676, 0.442334771156311,
0.337197124958038, -0.254822671413422, 0.104471303522587,
-0.071240097284317, -0.467238903045654, -0.186636582016945,
0.019772974774241, 0.344250172376633, 0.454141408205032,
0.221026435494423, -0.179233103990555, -0.040219925343990,
0.190895125269890, 0.352736800909042, -0.002535948762670,
-0.511012315750122, -0.601427495479584, -0.256927132606506,
0.198027864098549, 0.200459048151970, -0.273569852113724,
0.437129199504852, -0.191114172339439, 0.785521507263184,
-0.812865853309631, -0.020862899720669, -0.398826003074646,
0.030611967667937, 0.275251239538193, -0.512574553489685,
0.640753209590912, 0.265150278806686, 0.226357206702232,
-0.460246682167053, 0.096433855593204, 0.124206930398941,
0.427989304065704, -0.151371464133263, -0.194862708449364,
0.099467560648918, 0.076966047286987, -0.493250757455826,
-0.119656994938850, 0.338818073272705, 0.137577265501022,
0.186847031116486, -0.078484721481800, 0.189959511160851,
0.057302430272102, 0.156975284218788, -0.541522622108459,
-0.228105604648590, -0.011098606511950, -0.361717194318771,
0.499744892120361, -0.145254969596863, 0.143516048789024,
-0.466727942228317, 0.538627386093140, -0.292452216148376,
0.239327728748322, 0.504164457321167, -0.588814198970795,
0.213681891560555, -0.130359247326851, -0.154254347085953,
0.026576811447740, 0.130273044109344, -0.372004479169846,
0.048576172441244, -0.185261532664299, -0.082960747182369,
-0.184993803501129, -0.524867117404938, -0.142818346619606,
-0.283335715532303, -0.179814442992210, 0.665929734706879,
0.736068785190582, -0.072121709585190, -0.043317243456841,
0.263896971940994, 0.089134566485882, 0.504774034023285,
-0.450885683298111, -0.351501703262329, 0.021068209782243,
0.043173205107450, 0.384678572416306, 0.320046395063400, 
-0.038207348436117, 0.089564375579357, 0.206142649054527,
0.075483269989491, -0.391713142395020, 0.533289074897766,
-0.600375711917877, 0.886236608028412, -0.371700286865234,
0.358843952417374, -0.025885732844472, -0.075647406280041,
-0.472231954336166, -0.169803112745285, 0.273205846548080,
-0.333523780107498, -0.476729840040207, -0.101383142173290,
-0.114843942224979, 0.105708904564381, 0.657119810581207,
0.173286691308022, -0.447271645069122, -0.192904457449913,
0.493259817361832, -0.641270220279694, -0.234829723834991,
0.951365053653717, -0.158817350864410, -0.003736582584679,
-0.282454609870911, -0.512967646121979, -0.281908959150314,
-0.203307539224625, 0.104003094136715, -0.276060551404953,
0.376013368368149, 0.475065708160400, -0.428480416536331,
-0.031490322202444, -0.147806346416473, -0.612253367900848,
-0.203484401106834, 0.234939619898796, -0.319260209798813,
-0.252939403057098, 0.104196898639202, 0.500810325145721,
0.395928114652634, -0.160604625940323, 0.000510874146130,
0.358100175857544, -0.028516341000795, -0.340276539325714,
0.022185279056430, -0.198447272181511, 0.244363009929657,
0.140213295817375, -0.139178305864334, -0.063098601996899,
-0.497589886188507, -0.124963156878948, 0.406237244606018,
0.226355776190758, -0.345071285963058, -0.210003763437271,
-0.145731836557388, 0.212497085332870, 0.290438115596771,
-0.117794774472713, 0.261515289545059, 0.204965025186539,
0.115612722933292, 0.437876045703888, 0.053814981132746,
-0.073654271662235, 0.286636739969254, 0.569835603237152,
-0.222605422139168, 0.211335226893425, 0.539469420909882,
-0.125005111098289, 0.323224276304245, 0.301426231861115,
-0.274895757436752, 0.057610776275396, -0.228382155299187,
0.245231151580811, 0.206574425101280, 0.545289695262909,
-0.075078733265400, 0.383015036582947, -0.307067006826401,
-0.132196426391602, 0.211814269423485, 0.455824196338654, 
-0.037744227796793, 0.049573991447687, -0.199738129973412,
0.149086177349091, 0.109503336250782, 0.630581796169281,
0.505308568477631, -0.455991715192795, 0.257793217897415,
-0.304849356412888, 0.169350579380989, 0.174841403961182,
0.435541450977325, 0.110171034932137, 0.086097985506058,
0.357607096433640, 0.021464264020324, -0.245765507221222,
0.190232455730438, 0.329184144735336, -0.370295554399490,
-0.167615354061127, 0.430524170398712, -0.796550750732422,
-0.307220965623856, -0.195359960198402, 0.056879341602325,
0.711502671241760, -0.342780739068985, 0.104098752140999,
0.049148008227348, 0.399514764547348, -0.210380449891090,
0.466070652008057, -0.234828040003777, 0.168295413255692,
0.231032416224480, 0.463881790637970, -0.028512598946691,
-0.477855890989304, 0.055678430944681, 0.122130900621414,
0.288068413734436, 0.278707534074783, 0.053249422460794,
-0.415766447782516, -0.086940735578537, 0.703590333461761, ]

from sentence_transformers import SentenceTransformer

# Load a model.
model = SentenceTransformer('paraphrase-MiniLM-L6-v2')

# Embed the texts
embeddings = model.encode(texts)
print(embeddings.shape)

arrays_equal = np.isclose(embeddings[0], embedding_0)
if all(arrays_equal):
    print("embeddings[0] == embedding_0")
else:
    print("embeddings[0] != embedding_0")

# print("[ ")
# for i, x in enumerate(embeddings[0]):
#     if i % 3 == 0:
#         print()
#     print("%.15f" % x, end=", ")
# print("]")

from sklearn.cluster import KMeans

# Assuming embeddings is your list of sentence embeddings
n_clusters = 2  # for example, adjust based on your data
kmeans = KMeans(n_clusters=n_clusters)
labels = kmeans.fit_predict(embeddings)

# Group sentences by cluster
clusters = {i: [] for i in range(n_clusters)}
for label, text in zip(labels, texts):
    clusters[label].append(text)

# for label, cluster_texts in clusters.items():
#     print(f"Cluster {label}:")
#     for text in cluster_texts:
#         print(f"  - {text}")


import matplotlib.pyplot as plt
from sklearn.manifold import TSNE

# Reduce embedding dimensionality for visualization
tsne = TSNE(n_components=2, random_state=0, perplexity=5)
embeddings_2d = tsne.fit_transform(embeddings)

# Plot the results
plt.scatter(embeddings_2d[:, 0], embeddings_2d[:, 1], c=labels, cmap='jet')
plt.colorbar()
plt.show()
print("done")